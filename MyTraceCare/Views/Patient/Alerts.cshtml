@model List<MyTraceCare.Models.Alert>
@{
    Layout = "~/Views/Patient/_PatientLayout.cshtml";
    ViewData["Title"] = "Alerts";
}

<h2 class="mb-4">Alerts</h2>

@if (!Model.Any())
{
    <div class="alert alert-info">No alerts found.</div>
    return;
}

@foreach (var alert in Model)
{
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="fw-bold">@alert.Title</h5>
            <div class="small text-muted">
                @alert.CreatedAt.ToString("dd MMM yyyy • HH:mm")
            </div>
            <p class="mt-2">@alert.Message</p>

            <!-- 🔗 Link back to dashboard on that date -->
            <a class="btn btn-sm btn-outline-dark mb-3"
               href="/PatientDashboard/Index?date=@alert.CreatedAt.ToString("yyyy-MM-dd")">
                View around this time on dashboard
            </a>

            <!-- COMMENTS -->
            <h6 class="mt-3">Comments</h6>

            @if (alert.Comments != null && alert.Comments.Any())
            {
                <ul class="list-group mb-3">
                    @foreach (var c in alert.Comments)
                    {
                        <li class="list-group-item">
                            <strong>You:</strong> @c.Text
                            <div class="small text-muted">@c.CreatedAt.ToString("g")</div>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted">No comments yet.</p>
            }

            <!-- ADD COMMENT -->
            <form asp-action="AddComment" method="post" class="mt-3">
                <input type="hidden" name="alertId" value="@alert.Id" />
                <textarea class="form-control" name="comment" rows="2" placeholder="Write a comment..."></textarea>
                <button class="btn btn-dark mt-2">Submit</button>
            </form>
        </div>
    </div>
}
